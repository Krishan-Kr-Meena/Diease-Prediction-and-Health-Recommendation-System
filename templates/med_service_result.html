<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/creativetimofficial/tailwind-starter-kit/compiled-tailwind.min.css"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='Diagnosmart icon.png') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title>DiagnoSmart | Diagnosis Results</title>
    <style>
        .custom-bg {
            background-color: #f7fafc; /* Light gray/white for content area */
        }
    </style>
</head>
<body class="antialiased custom-bg">

    <!-- Navigation Bar (Fixed) -->
    <nav class="flex items-center text-black">
        <div class="top-0 absolute z-50 w-full flex flex-wrap items-center justify-between px-6 py-3 shadow-xl bg-white">
            <a href="{{ url_for('index') }}" title="Home" class="flex items-center font-bold text-xl px-2">
                <img src="{{ url_for('static', filename='Diagnosmart icon.png') }}" alt="DiagnoSmart Logo" class="h-8 mr-2"/>
                <span>DiagnoSmart</span>
            </a>
            <ul class="flex-1 text-center text-black">
                <li class="list-none inline-block px-5 text-lg leading-lg transition-colors duration-300">
                    <a href="{{ url_for('index') }}" class="no-underline px-2 text-black hover:text-gray-600">Home</a>
                </li>
                <li class="list-none inline-block px-5 text-lg leading-lg transition-colors duration-300">
                    <a href="{{ url_for('services') }}" class="no-underline px-2 text-black hover:text-gray-600">Diease Detection</a>
                </li>
                <!-- Current Page Highlight -->
                <li class="list-none inline-block px-5 text-lg leading-lg transition-colors duration-300 font-bold text-gray-800 border-b-2 border-indigo-500">
                    <a href="{{ url_for('med_service') }}" class="no-underline px-2 text-black hover:text-gray-600">Medicine Recommendation</a>
                </li>
                <li class="list-none inline-block px-5 text-lg leading-lg transition-colors duration-300">
                    <a href="{{ url_for('doc_service') }}" class="no-underline px-2 text-black hover:text-gray-600">Treatment centers</a>
                </li>
                <li class="list-none inline-block px-5 text-lg leading-lg transition-colors duration-300">
                    <a href="{{ url_for('faq') }}" class="no-underline px-2 text-black hover:text-gray-600">FAQs</a>
                </li>
            </ul>
        </div>
    </nav>
    <main class="pt-24 pb-8 min-h-screen">
        <div class="container mx-auto px-4 max-w-4xl">
            <h1 class="text-4xl font-bold text-center mb-4 text-black-700">Diagnosis Complete</h1>
            <p class="text-xl text-center text-gray-600 mb-8">AI Analysis Report generated on your provided symptoms.</p>

            <!-- Input Summary -->
            <div class="bg-gray-50 p-6 rounded-xl shadow-2xl mb-6">
                <p class="text-2xl font-semibold text-gray-700 mb-2">Analysis Summary</p>
                <!-- FIX: Use passed variable input_symptoms -->
                <p class="text-md"><strong>Input Symptoms:</strong> <span class="font-medium bg-gray-200 px-2 py-1 rounded">{{ input_symptoms }}</span></p>
                <p class="text-md"><strong>Analyzed Symptoms:</strong> {{ result.symptoms_analyzed | join(', ') }}</p>
                <p class="text-md"><strong>AI Model Used:</strong> {{ result.model_used }}</p>
            </div>
            
            <!-- Warning Message -->
            {% if warning %}
            <div class="bg-yellow-100 p-4 rounded-lg border-yellow-500 shadow-2xl mb-6 font-small">
                <i class="fas fa-exclamation-triangle mr-2"></i> {{ warning }}
            </div>
            {% endif %}

            <!-- Unrecognized Symptoms -->
            {% if result.invalid_symptoms %}
            <div class="bg-red-100 p-4 rounded-lg border-red-500 shadow-2xl mb-6 font-small">
                <i class="fas fa-times-circle mr-2"></i> 
                <strong>Unrecognized Symptoms:</strong> The following symptoms were not found in the system and were ignored: 
                <span class="font-mono">{{ result.invalid_symptoms | join(', ') }}</span>
            </div>
            {% endif %}

            <!-- Primary Diagnosis -->
            
            <div class="bg-white p-8 rounded-xl shadow-2xl mb-8">
            
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-3xl font-bold text-gray-800">Primary Diagnosis:</h2>
                    <span class="text-3xl font-extrabold text-red-600">{{ "%.2f"|format(result.primary_confidence * 100) }}%</span>
                </div>
                <h3 class="text-2xl text-red-600 font-semibold mb-4">{{ result.primary_diagnosis }}</h3>
                <p class="text-gray-700 leading-relaxed">{{ result.predictions[0].medical_info.description }}</p>
            </div>
            
            {% set info = result.predictions[0].medical_info %}
            
            <!-- Recommendations Section -->
            <div class="bg-white p-8 rounded-xl shadow-2xl mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Action & Treatment Plan</h2>
                
                <!-- Precautions -->
                <div class="mb-6 border-b pb-4">
                    <h3 class="text-xl font-semibold text-green-600 mb-2"><i class="fas fa-shield-alt mr-2"></i> Recommended Precautions:</h3>
                    {% if info.precautions %}
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        {% for p in info.precautions %}
                        <li>{{ p }}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-gray-500 italic">No specific precautions found in the system.</p>
                    {% endif %}
                </div>

                <!-- Medications -->
                <div class="mb-6 border-b pb-4">
                    <h3 class="text-xl font-semibold text-green-600 mb-2"><i class="fas fa-pills mr-2"></i> Suggested Medications:</h3>
                    <p class="text-sm text-red-500 mb-3 font-medium">⚠️ Always consult your doctor before starting any medication.</p>
                    {% if info.medications %}
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        {% for m in info.medications %}
                        <li>{{ m }}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-gray-500 italic">No specific medications found in the system.</p>
                    {% endif %}
                </div>

                <!-- Diet -->
                <div class="mb-6 border-b pb-4">
                    <h3 class="text-xl font-semibold text-green-600 mb-2"><i class="fas fa-utensils mr-2"></i> Dietary Recommendations:</h3>
                    {% if info.diet %}
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        {% for d in info.diet %}
                        <li>{{ d }}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-gray-500 italic">No specific dietary recommendations found in the system.</p>
                    {% endif %}
                </div>

                <!-- Workout/Lifestyle -->
                <div class="mb-6">
                    <h3 class="text-xl font-semibold text-green-600 mb-2"><i class="fas fa-running mr-2"></i> Lifestyle & Workout:</h3>
                    {% if info.workout %}
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        {% for w in info.workout %}
                        <li>{{ w }}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-gray-500 italic">No specific lifestyle recommendations found in the system.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Differential Diagnosis -->
            <div class="bg-white p-6 rounded-xl shadow-2xl mb-8">
                <h3 class="text-2xl font-bold text-gray-700 mb-4">Differential Diagnosis (Other Possibilities)</h3>
                <ul class="divide-y divide-gray-200">
                    {% for pred in result.predictions %}
                    <li class="py-3 flex justify-between items-center">
                        <span class="text-lg text-gray-800">{{ pred.disease }}</span>
                        <span class="font-mono text-gray-600">{{ "%.2f"|format(pred.confidence * 100) }}%</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Disclaimer -->
            <div class="p-6 bg-red-100 rounded-xl shadow-2xl mb-8">
                <h3 class="font-bold text-xl mb-2"><i class="fas fa-triangle-exclamation mr-2"></i> IMPORTANT MEDICAL DISCLAIMER</h3>
                <p class="text-sm">This AI-generated report is for informational and educational purposes <strong>ONLY</strong>. It is <strong>NOT</strong> a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of a qualified healthcare provider with any questions you may have regarding a medical condition.</p>
            </div>

            <div class="text-center">
                <a href="{{ url_for('med_service') }}" class="inline-block bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg transition duration-150 ease-in-out">
                    <i class="fas fa-redo mr-2"></i> Start New Diagnosis
                </a>
            </div>

        </div>
    </main>

</body>
</html>
